# Parallax Architecture

## System Overview

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                              PARALLAX SYSTEM                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                               â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                        ğŸ“¡ DATA SOURCES                                  â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â•‘
â•‘  â”‚   â”‚   RSS FEEDS     â”‚              â”‚   GDELT API     â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚              â”‚                 â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ NYT          â”‚              â”‚  Global event   â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ BBC          â”‚              â”‚  detection +    â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ CGTN         â”‚              â”‚  geolocation    â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ Yonhap       â”‚              â”‚                 â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ NHK          â”‚              â”‚                 â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  â€¢ ... (35)     â”‚              â”‚                 â”‚                 â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â•‘
â•‘  â”‚            â”‚                                â”‚                          â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘               â”‚                                â”‚                              â•‘
â•‘               â–¼                                â–¼                              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                     âš™ï¸  WORKER PROCESS                                  â”‚  â•‘
â•‘  â”‚                     (runs separately from web server)                   â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â•‘
â•‘  â”‚   â”‚ FETCH FEEDS â”‚  â”‚ FETCH GDELT â”‚  â”‚  PROCESS    â”‚  â”‚  CLUSTER    â”‚  â”‚  â•‘
â•‘  â”‚   â”‚             â”‚  â”‚             â”‚  â”‚  ARTICLE    â”‚  â”‚  EVENTS     â”‚  â”‚  â•‘
â•‘  â”‚   â”‚ â° 15 min   â”‚  â”‚ â° 15 min   â”‚  â”‚             â”‚  â”‚             â”‚  â”‚  â•‘
â•‘  â”‚   â”‚             â”‚  â”‚             â”‚  â”‚ (on-demand) â”‚  â”‚ â° 30 min   â”‚  â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â”‚  â•‘
â•‘  â”‚          â”‚                â”‚                â”‚                â”‚          â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘             â”‚                â”‚                â”‚                â”‚              â•‘
â•‘             â–¼                â–¼                â–¼                â–¼              â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸ”„ PROCESSING PIPELINE                               â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â” â”‚  â•‘
â•‘  â”‚   â”‚  PARSE  â”‚â”€â”€â”€â–¶â”‚ DEDUP   â”‚â”€â”€â”€â–¶â”‚ EXTRACT â”‚â”€â”€â”€â–¶â”‚ DETECT  â”‚â”€â”€â”€â–¶â”‚EMBEDâ”‚ â”‚  â•‘
â•‘  â”‚   â”‚  RSS    â”‚    â”‚  URLs   â”‚    â”‚  TEXT   â”‚    â”‚  LANG   â”‚    â”‚     â”‚ â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”¬â”€â”€â”˜ â”‚  â•‘
â•‘  â”‚                                                                   â”‚    â”‚  â•‘
â•‘  â”‚   rss-parser     normalize +    @extractus     franc library   OpenAI â”‚  â•‘
â•‘  â”‚                  check DB       article-ext    + fallback      API   â”‚  â•‘
â•‘  â”‚                                                                   â”‚    â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                      â”‚       â•‘
â•‘                                                                      â–¼       â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸ¯ EVENT CLUSTERING                                  â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚  â•‘
â•‘  â”‚                        â”‚  New Article     â”‚                            â”‚  â•‘
â•‘  â”‚                        â”‚  (with embedding)â”‚                            â”‚  â•‘
â•‘  â”‚                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚  â•‘
â•‘  â”‚                                 â”‚                                       â”‚  â•‘
â•‘  â”‚                                 â–¼                                       â”‚  â•‘
â•‘  â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â•‘
â•‘  â”‚                   â”‚  Compare embedding to all   â”‚                      â”‚  â•‘
â•‘  â”‚                   â”‚  active event centroids     â”‚                      â”‚  â•‘
â•‘  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â•‘
â•‘  â”‚                                 â”‚                                       â”‚  â•‘
â•‘  â”‚                                 â–¼                                       â”‚  â•‘
â•‘  â”‚                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â”‚  â•‘
â•‘  â”‚                   â”‚   Cosine Similarity > ?     â”‚                      â”‚  â•‘
â•‘  â”‚                   â”‚                             â”‚                      â”‚  â•‘
â•‘  â”‚                   â”‚   Same language: 0.80      â”‚                      â”‚  â•‘
â•‘  â”‚                   â”‚   Cross language: 0.75     â”‚                      â”‚  â•‘
â•‘  â”‚                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                      â”‚  â•‘
â•‘  â”‚                              â”‚                                          â”‚  â•‘
â•‘  â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                         â”‚  â•‘
â•‘  â”‚              â”‚                               â”‚                          â”‚  â•‘
â•‘  â”‚              â–¼                               â–¼                          â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â•‘
â•‘  â”‚   â”‚  YES: Similar    â”‚            â”‚  NO: Not similar â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚                  â”‚            â”‚                  â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  Assign article  â”‚            â”‚  Create NEW      â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  to that event   â”‚            â”‚  event from      â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚                  â”‚            â”‚  this article    â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  Update event's  â”‚            â”‚                  â”‚                 â”‚  â•‘
â•‘  â”‚   â”‚  centroid        â”‚            â”‚                  â”‚                 â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                         â”‚                                     â•‘
â•‘                                         â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸ’¾ POSTGRESQL + PGVECTOR                             â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚  â•‘
â•‘  â”‚   â”‚    OUTLETS      â”‚  â”‚    ARTICLES     â”‚  â”‚     EVENTS      â”‚       â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚                 â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  id             â”‚  â”‚  id             â”‚  â”‚  id             â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  name           â”‚  â”‚  outlet_id â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚  title          â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  slug           â”‚  â”‚  url            â”‚  â”‚  summary        â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  country        â”‚  â”‚  title          â”‚  â”‚  location       â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  region         â”‚  â”‚  content        â”‚  â”‚  lat/long       â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  language       â”‚  â”‚  summary        â”‚  â”‚  article_count  â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  rss_feeds[]    â”‚  â”‚  language       â”‚  â”‚                 â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  active         â”‚  â”‚  published_at   â”‚  â”‚  centroid_      â”‚       â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚  â”‚  event_id â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶  embedding      â”‚       â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚  [1536 floats]  â”‚       â”‚  â•‘
â•‘  â”‚   â”‚  35 rows        â”‚  â”‚  embedding      â”‚  â”‚                 â”‚       â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚  â”‚  [1536 floats]  â”‚  â”‚  status         â”‚       â”‚  â•‘
â•‘  â”‚   â”‚                 â”‚  â”‚                 â”‚  â”‚  (active/stale) â”‚       â”‚  â•‘
â•‘  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                         â”‚                                     â•‘
â•‘                                         â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸŒ NEXT.JS API ROUTES                                â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   GET /api/events          GET /api/articles       GET /api/outlets    â”‚  â•‘
â•‘  â”‚   â”œâ”€ ?status=active        â”œâ”€ ?outlet=bbc          â””â”€ ?country=US      â”‚  â•‘
â•‘  â”‚   â”œâ”€ ?region=east_asia     â”œâ”€ ?event_id=...                            â”‚  â•‘
â•‘  â”‚   â””â”€ ?since=2024-01-01     â””â”€ ?language=en                             â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   GET /api/events/[id]     GET /api/health                             â”‚  â•‘
â•‘  â”‚   â””â”€ Full event + all      â””â”€ DB connectivity check                    â”‚  â•‘
â•‘  â”‚      articles grouped                                                   â”‚  â•‘
â•‘  â”‚      by country                                                         â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                         â”‚                                     â•‘
â•‘                                         â–¼                                     â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â•‘
â•‘  â”‚                    ğŸ–¥ï¸ WEB FRONTEND (Phase 2)                            â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â”‚   â€¢ World map with event hotspots (deck.gl)                            â”‚  â•‘
â•‘  â”‚   â€¢ Divergence wheel showing outlet framing                            â”‚  â•‘
â•‘  â”‚   â€¢ Outlet constellation map                                            â”‚  â•‘
â•‘  â”‚   â€¢ Timeline view for narrative drift                                   â”‚  â•‘
â•‘  â”‚                                                                         â”‚  â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â•‘
â•‘                                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## Data Flow Sequence

```
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                         EVERY 15 MINUTES                                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Worker                    RSS Feeds                  Database
        â”‚                          â”‚                          â”‚
        â”‚   1. Fetch all feeds     â”‚                          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                          â”‚
        â”‚                          â”‚                          â”‚
        â”‚   2. Get articles        â”‚                          â”‚
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                          â”‚
        â”‚   (title, link, date)    â”‚                          â”‚
        â”‚                          â”‚                          â”‚
        â”‚   3. For each new URL:                              â”‚
        â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                              â”‚
        â”‚                                                     â”‚
        â”‚   3a. Check if exists    â”‚                          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”‚
        â”‚                          â”‚                          â”‚
        â”‚   3b. "No, it's new"     â”‚                          â”‚
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
        â”‚                          â”‚                          â”‚
        â”‚   3c. Queue for processing                          â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â–¶ [REDIS QUEUE]                              â”‚
        â”‚                          â”‚                          â”‚

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                         FOR EACH QUEUED ARTICLE                         â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Worker                   Article URL               OpenAI            DB
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   1. Fetch full HTML     â”‚                      â”‚               â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                      â”‚               â”‚
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   2. Extract text        â”‚                      â”‚               â”‚
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                      â”‚               â”‚
        â”‚   (content, author)      â”‚                      â”‚               â”‚
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   3. Detect language                            â”‚               â”‚
        â”‚   (using franc)                                 â”‚               â”‚
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   4. Generate embedding                         â”‚               â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚               â”‚
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   5. Return 1536 floats                         â”‚               â”‚
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚               â”‚
        â”‚                          â”‚                      â”‚               â”‚
        â”‚   6. Store article + embedding                  â”‚               â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
        â”‚                          â”‚                      â”‚               â”‚

     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                         EVERY 30 MINUTES                                â”‚
     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

     Worker                                              Database
        â”‚                                                    â”‚
        â”‚   1. Get unclustered articles                     â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
        â”‚                                                    â”‚
        â”‚   2. Get active events                            â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
        â”‚                                                    â”‚
        â”‚   3. For each article:                            â”‚
        â”‚                                                    â”‚
        â”‚      a. Compare embedding to each event centroid  â”‚
        â”‚      b. cosine_similarity(article, event) > 0.75? â”‚
        â”‚                                                    â”‚
        â”‚      IF YES:                                       â”‚
        â”‚         - Assign article.event_id = event.id      â”‚
        â”‚         - Update event centroid (running avg)     â”‚
        â”‚                                                    â”‚
        â”‚      IF NO MATCH:                                  â”‚
        â”‚         - Create new event                        â”‚
        â”‚         - Set centroid = article embedding        â”‚
        â”‚                                                    â”‚
        â”‚   4. Save all changes                             â”‚
        â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶
        â”‚                                                    â”‚
```

---

## Embedding & Clustering Deep Dive

```
                            WHAT IS AN EMBEDDING?
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Text:     "China conducts military exercises near Taiwan"
                                    â”‚
                                    â–¼
                            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                            â”‚   OpenAI API  â”‚
                            â”‚   text-embed- â”‚
                            â”‚   ding-3-smallâ”‚
                            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
    Embedding: [0.023, -0.451, 0.122, 0.089, -0.234, ... ]  (1536 numbers)



                          WHY DO EMBEDDINGS WORK?
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Similar meaning = Similar numbers = Close in 1536-dimensional space


    Article A: "PLA conducts exercises in Taiwan Strait"
                          â”‚
                          â–¼
              [0.02, -0.45, 0.12, ...]  â”€â”€â”€â”€â”€â”€â”
                                              â”‚
                                              â”‚  SIMILAR
                                              â”‚  (close together)
                                              â”‚
              [0.03, -0.44, 0.11, ...]  â”€â”€â”€â”€â”€â”€â”˜
                          â–²
                          â”‚
    Article B: "Chinese military drills near Taiwan"



    Article C: "K-pop group BTS announces world tour"
                          â”‚
                          â–¼
              [0.78, 0.23, -0.56, ...]  â—€â”€â”€â”€â”€ DIFFERENT
                                              (far apart)



                          HOW CLUSTERING WORKS
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    EVENT 1: "Taiwan Military Tensions"
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Centroid: [0.025, -0.445, 0.115, ...]                 â”‚
    â”‚  (average of all article embeddings in this event)     â”‚
    â”‚                                                         â”‚
    â”‚  Articles:                                              â”‚
    â”‚    â€¢ BBC: "China conducts military exercises"          â”‚
    â”‚    â€¢ NYT: "US warns of Taiwan tensions"                â”‚
    â”‚    â€¢ CGTN: "PLA routine training near Taiwan"          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


    NEW ARTICLE arrives: "Taiwan reports Chinese aircraft incursion"
    Embedding: [0.028, -0.442, 0.118, ...]

    Compare to Event 1 centroid:

        cosine_similarity([0.028, -0.442, 0.118, ...],
                          [0.025, -0.445, 0.115, ...])

        = 0.94  (94% similar)

        0.94 > 0.80 threshold  âœ“

        â†’ ADD to Event 1!
        â†’ Update centroid to include new article



                      CENTROID UPDATE (Running Average)
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Before: Event has 3 articles, centroid = [0.025, -0.445, 0.115]

    New article embedding = [0.028, -0.442, 0.118]

    New centroid = old_centroid + (new_embedding - old_centroid) / 4

    For first dimension:
        0.025 + (0.028 - 0.025) / 4 = 0.025 + 0.00075 = 0.02575

    After: Event has 4 articles, centroid = [0.02575, -0.4443, 0.1158]



                      WHY TWO THRESHOLDS?
    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Same language (EN â†’ EN):     0.80 threshold (stricter)
    Cross language (EN â†’ KO):    0.75 threshold (looser)

    Why? Translation affects embedding similarity.

    English: "China military exercises"     â†’ [0.02, -0.45, ...]
    Korean:  "ì¤‘êµ­ êµ°ì‚¬ í›ˆë ¨"                 â†’ [0.05, -0.42, ...]

    Same topic, but embeddings are ~75-80% similar, not 95%.
    Lower threshold catches these cross-language matches.
```

---

## File Map

```
parallax/
â”‚
â”œâ”€â”€ ğŸ“ src/
â”‚   â”œâ”€â”€ ğŸ“ app/                          â—€â”€â”€ NEXT.JS APP ROUTER
â”‚   â”‚   â”œâ”€â”€ ğŸ“ api/
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ events/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ route.ts             GET /api/events (list)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ [id]/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ route.ts         GET /api/events/:id (single)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ articles/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts             GET /api/articles
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ outlets/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ route.ts             GET /api/outlets
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ health/
â”‚   â”‚   â”‚       â””â”€â”€ route.ts             GET /api/health
â”‚   â”‚   â”œâ”€â”€ layout.tsx                   Root layout (HTML wrapper)
â”‚   â”‚   â””â”€â”€ page.tsx                     Home page component
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“ lib/                          â—€â”€â”€ SHARED BUSINESS LOGIC
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ db/
â”‚   â”‚   â”‚   â”œâ”€â”€ schema.ts                â˜… DATABASE TABLES (Drizzle ORM)
â”‚   â”‚   â”‚   â”‚                              - outlets, articles, events
â”‚   â”‚   â”‚   â”‚                              - narrative_scores (Phase 2)
â”‚   â”‚   â”‚   â”‚                              - outlet_alignments (Phase 2)
â”‚   â”‚   â”‚   â””â”€â”€ client.ts                Database connection setup
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ ingestion/
â”‚   â”‚   â”‚   â”œâ”€â”€ rss-parser.ts            â˜… FETCH & PARSE RSS FEEDS
â”‚   â”‚   â”‚   â”‚                              - Uses rss-parser library
â”‚   â”‚   â”‚   â”‚                              - Handles various feed formats
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ article-extractor.ts     â˜… EXTRACT FULL ARTICLE TEXT
â”‚   â”‚   â”‚   â”‚                              - Uses @extractus/article-extractor
â”‚   â”‚   â”‚   â”‚                              - Detects language with franc
â”‚   â”‚   â”‚   â”‚                              - Falls back to RSS summary
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ deduplicator.ts          â˜… PREVENT DUPLICATE ARTICLES
â”‚   â”‚   â”‚   â”‚                              - Normalizes URLs (strips tracking)
â”‚   â”‚   â”‚   â”‚                              - Checks database before processing
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ gdelt.ts                 GDELT API integration
â”‚   â”‚   â”‚                                  - Supplementary event detection
â”‚   â”‚   â”‚                                  - Geographic filtering
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ clustering/
â”‚   â”‚   â”‚   â”œâ”€â”€ embeddings.ts            â˜… OPENAI EMBEDDING GENERATION
â”‚   â”‚   â”‚   â”‚                              - Rate limiting (3 concurrent)
â”‚   â”‚   â”‚   â”‚                              - Retry with backoff
â”‚   â”‚   â”‚   â”‚                              - Cosine similarity function
â”‚   â”‚   â”‚   â”‚                              - Centroid calculation
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ event-clusterer.ts       â˜… GROUP ARTICLES INTO EVENTS
â”‚   â”‚   â”‚                                  - Language-aware thresholds
â”‚   â”‚   â”‚                                  - Running centroid updates
â”‚   â”‚   â”‚                                  - Stale event marking
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ outlets/
â”‚   â”‚   â”‚   â””â”€â”€ registry.ts              â˜… 35 OUTLET DEFINITIONS
â”‚   â”‚   â”‚                                  - Name, country, region, language
â”‚   â”‚   â”‚                                  - RSS feed URLs
â”‚   â”‚   â”‚                                  - Helper functions
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“ types/
â”‚   â”‚   â”‚   â””â”€â”€ index.ts                 TypeScript type definitions
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ logger.ts                    Structured logging (pino)
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ components/                   React components (Phase 2)
â”‚
â”œâ”€â”€ ğŸ“ worker/                           â—€â”€â”€ BACKGROUND JOB PROCESSOR
â”‚   â”‚
â”‚   â”œâ”€â”€ index.ts                         â˜… WORKER ENTRY POINT
â”‚   â”‚                                      - Starts all job processors
â”‚   â”‚                                      - Graceful shutdown handling
â”‚   â”‚
â”‚   â”œâ”€â”€ queue.ts                         â˜… BULLMQ QUEUE DEFINITIONS
â”‚   â”‚                                      - Queue creation
â”‚   â”‚                                      - Scheduled job setup
â”‚   â”‚                                      - Helper functions
â”‚   â”‚
â”‚   â””â”€â”€ ğŸ“ jobs/
â”‚       â”œâ”€â”€ fetch-feeds.ts               â˜… RSS POLLING JOB (every 15 min)
â”‚       â”‚                                  - Loops through all outlets
â”‚       â”‚                                  - Queues new articles
â”‚       â”‚
â”‚       â”œâ”€â”€ process-article.ts           â˜… ARTICLE PROCESSING JOB
â”‚       â”‚                                  - Extract â†’ Detect â†’ Embed â†’ Store
â”‚       â”‚
â”‚       â”œâ”€â”€ cluster-events.ts            â˜… CLUSTERING JOB (every 30 min)
â”‚       â”‚                                  - Groups unclustered articles
â”‚       â”‚
â”‚       â””â”€â”€ fetch-gdelt.ts               GDELT fetching job
â”‚
â”œâ”€â”€ ğŸ“ scripts/
â”‚   â”œâ”€â”€ seed-outlets.ts                  Populate outlets table
â”‚   â”œâ”€â”€ test-rss.ts                      Test RSS parsing only
â”‚   â””â”€â”€ test-pipeline.ts                 Full integration test
â”‚
â”œâ”€â”€ ğŸ“ docs/
â”‚   â””â”€â”€ architecture.md                  This file!
â”‚
â”œâ”€â”€ docker-compose.yml                   Postgres + Redis containers
â”œâ”€â”€ Dockerfile.postgres                  Custom image with pgvector
â”œâ”€â”€ drizzle.config.ts                    ORM configuration
â”œâ”€â”€ .env.example                         Environment template
â”œâ”€â”€ CLAUDE.md                            Learning guide
â””â”€â”€ README.md                            Project overview
```

---

## Mermaid Diagrams (for GitHub/VS Code rendering)

### System Overview

```mermaid
flowchart TB
    subgraph Sources["Data Sources"]
        RSS[RSS Feeds<br/>35 outlets]
        GDELT[GDELT API]
    end

    subgraph Worker["Worker Process"]
        FetchJob[Fetch Feeds<br/>every 15 min]
        ProcessJob[Process Article]
        ClusterJob[Cluster Events<br/>every 30 min]
    end

    subgraph Pipeline["Processing"]
        Parse[Parse RSS]
        Dedup[Deduplicate]
        Extract[Extract Text]
        Lang[Detect Language]
        Embed[Generate Embedding]
    end

    subgraph Cluster["Clustering"]
        Compare[Compare to Events]
        Decision{Similar?}
        Assign[Assign to Event]
        Create[Create New Event]
    end

    subgraph DB["PostgreSQL + pgvector"]
        Outlets[(outlets)]
        Articles[(articles)]
        Events[(events)]
    end

    subgraph API["Next.js API"]
        E_API[/api/events]
        A_API[/api/articles]
        O_API[/api/outlets]
    end

    RSS --> FetchJob
    GDELT --> FetchJob
    FetchJob --> Parse --> Dedup --> ProcessJob
    ProcessJob --> Extract --> Lang --> Embed
    Embed --> Articles

    ClusterJob --> Compare
    Articles --> Compare
    Events --> Compare
    Compare --> Decision
    Decision -->|Yes| Assign --> Events
    Decision -->|No| Create --> Events

    Outlets --> O_API
    Articles --> A_API
    Events --> E_API
```

### Data Flow Sequence

```mermaid
sequenceDiagram
    participant W as Worker
    participant RSS as RSS Feeds
    participant DB as PostgreSQL
    participant AI as OpenAI

    loop Every 15 minutes
        W->>RSS: Fetch all feeds
        RSS-->>W: Articles (title, link)
        W->>DB: Check if URL exists
        DB-->>W: New/Existing
        W->>W: Queue new articles
    end

    loop For each queued article
        W->>RSS: Fetch full HTML
        RSS-->>W: HTML content
        W->>W: Extract text (extractus)
        W->>W: Detect language (franc)
        W->>AI: Generate embedding
        AI-->>W: 1536-dim vector
        W->>DB: Store article + embedding
    end

    loop Every 30 minutes
        W->>DB: Get unclustered articles
        W->>DB: Get active events
        W->>W: Compare embeddings
        alt Similarity > threshold
            W->>DB: Assign to event
            W->>DB: Update centroid
        else No match
            W->>DB: Create new event
        end
    end
```
